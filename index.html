<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TODO</title>
    <link rel="stylesheet" href="src/output.css" />
  </head>
  <body>
    <main class="max-w-2xl mx-auto mt-20">
      <form method="post" id="new-todo-form">
        <div class="flex gap-4 items-center bg-slate-900 p-5">
          <input type="checkbox" name="" id="" disabled />
          <input
            type="text"
            name="new-todo-input"
            aria-label="Create new todo item"
            placeholder="Create new todo"
            class="text-white w-full"
          />
        </div>
      </form>
      <div class="bg-slate-900 text-gray-200">
        <ul class="divide-y divide-gray-600" id="todo-items">
          <!-- <li class="flex gap-4 items-center p-5">
          <input type="checkbox" name="todo-item" id="todo-item" class="peer" />
          <label
            for="todo-item"
            class="peer-checked:line-through peer-checked:text-gray-600"
            >Complete online course</label
          >
        </li> -->
        </ul>
        <div
          class="flex items-center justify-between gap-4 mt-4 p-5 text-gray-500"
        >
          <p>5 items left</p>
          <form method="post" id="toggle-form">
            <div class="flex gap-4">
              <div>
                <input type="radio" name="toggle-state" id="all" value="all" />
                <label for="all">All (<span id="all-count">0</span>)</label>
              </div>

              <div>
                <input
                  type="radio"
                  name="toggle-state"
                  id="active"
                  value="active"
                />
                <label for="active"
                  >Active (<span id="active-count">0</span>)</label
                >
              </div>

              <div>
                <input
                  type="radio"
                  name="toggle-state"
                  id="completed"
                  value="completed"
                />
                <label for="completed"
                  >Completed (<span id="completed-count">0</span>)</label
                >
              </div>
            </div>
          </form>
          <button>Clear completed</button>
        </div>
      </div>
    </main>
    <script>
      // Get the user inputs
      // Store the inputs in an array
      // Create the list item
      // Add the list item to the ul

      let todoItems = document.getElementById("todo-items");
      let newTodoForm = document.getElementById("new-todo-form");
      let toggleForm = document.getElementById("toggle-form");
      let allCount = document.getElementById("all-count");
      let activeCount = document.getElementById("active-count");
      let completedCount = document.getElementById("completed-count");

      let newTodoItems = [];
      let filtered = newTodoItems;

      function showList() {
        // Create list item

        todoItems.innerHTML = "";

        filtered.forEach((item) => {
          let li = document.createElement("li");
          li.className = "flex gap-4 items-center p-5";

          let todoItemCheckbox = document.createElement("input");
          todoItemCheckbox.setAttribute("type", "checkbox");
          todoItemCheckbox.setAttribute("name", `${item.id}`);
          todoItemCheckbox.setAttribute("id", `${item.id}`);
          todoItemCheckbox.className = "peer";
          todoItemCheckbox.addEventListener("change", (event) =>
            toggleComplete(event),
          );

          // If the todo item is complete, mark it as complete by adding the checked state
          if (item.isComplete) {
            todoItemCheckbox.checked = true;
          }

          let label = document.createElement("label");
          label.setAttribute("for", `${item.id}`);
          label.textContent = item.todoItem;
          label.className =
            "peer-checked:line-through peer-checked:text-gray-600";

          li.append(todoItemCheckbox);
          li.append(label);
          todoItems.append(li);

          allCount.textContent = newTodoItems.length;
        });
      }

      function toggleComplete(event) {
        // Find the input obj that matches the id provided and toggle its isComplete status
        console.log(event.target);
        let checkedInputId = event.target.id;
        console.log({ checkedInputId });

        let matchedObj = newTodoItems.find(
          (item) => item.id === checkedInputId,
        );
        console.log({ matchedObj });

        matchedObj.isComplete = !matchedObj.isComplete;
        console.log({ newTodoItems });
      }

      newTodoForm.addEventListener("submit", (event) => {
        event.preventDefault();

        // Get user input
        let formData = new FormData(newTodoForm);
        let newTodoInput = formData.get("new-todo-input");

        console.log({ newTodoInput });

        // Store the input in an array
        newTodoItems.push({
          todoItem: newTodoInput,
          isComplete: false,
          id: `todo-item-${newTodoItems.length + 1}`,
        });

        console.log({ newTodoItems });

        showList();

        newTodoForm.reset();
      });

      // Filter the list according to the status of the todo item
      toggleForm.addEventListener("change", (event) => {
        console.log("Changed");
        let formData = new FormData(toggleForm);
        let toggleState = formData.get("toggle-state");
        console.log({ toggleState });

        // Filter todo items array based on the selected state
        if (toggleState === "active") {
          filtered = newTodoItems.filter((item) => item.isComplete === false);
          activeCount.textContent = filtered.length;
        } else if (toggleState === "completed") {
          filtered = newTodoItems.filter((item) => item.isComplete === true);
          completedCount.textContent = filtered.length;
        } else if (toggleState === "all") {
          filtered = newTodoItems;
        }

        console.log({ filtered });

        // Update the list (UI)

        showList();
      });
    </script>
  </body>
</html>
